/*! Javascript v0.0.1 CAR.com (c)2014 - Team:http://www.car.com/humans.txt */!function e(t,n,r){function s(a,i){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!i&&c)return c(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(e,t,n){"use strict";!function(t,n,r){var s=function(){var t=e("../../modules/abt-svc-c4s"),s=r.PERSONA,o=n("body"),a=e("./index_tmpls/desk/tmpls.js"),i="clear_selections_overlay_js",c=t.criteria,l="#",u="click",d="li",f="_js",p="show",m="selected",g=m,h="undefined",v=".carsForSaleMake",k=".carsForSaleCategory",y="btnChooseModels",_="btnChooseMakes",w="btnShowAllMakes",b="btnShowAllCategories",C="clear-selections-text",S="overlay-close",x="close-clear-selections-container",M="continue-clear-selections-container",E=function(e,t){typeof t===h&&(t=!e.hasClass(g)),t?n(k).parent().parent("."+g).length>=1?(n(l+C).html("Continue with Make choice and Clear Category Selections?"),n(l+M).on("click",function(){c.set({filters:{categories:""}},!0),n(k).parent().parent("."+g).removeClass(g),n(l+_).hide(),n(l+b).show(),n(l+i).popup("hide"),n(l+w).hide(),n(l+y).show(),e.addClass(g)}),n(l+i).popup("show")):(n(l+w).hide(),n(l+y).show(),e.addClass(g)):(e.removeClass(g),0==n(v+"."+g).length&&(n(l+y).hide(),n(l+w).show()))},T=function(e,t){typeof t===h&&(t=!e.hasClass(g)),t?n(".carsForSaleMake.selected").length>=1?(n(l+C).html("Continue with Category choice and Clear Make Selections?"),n(l+M).on("click",function(){c.set({filters:{makes:"",make_models:""}},!0),n(".carsForSaleMake.selected").removeClass(g),n(l+y).hide(),n(l+w).show(),n(l+i).popup("hide"),n(l+b).hide(),n(l+_).show(),e.addClass(g)}),n(l+i).popup("show")):(n(l+b).hide(),n(l+_).show(),e.addClass(g)):(e.removeClass(g),0==n(k).parent().parent("."+g).length&&(n(l+_).hide(),n(l+b).show()))};return{init:function(){var e=n(l+"categories"+f),r=n(l+"makes"+f),m=n(l+p+"_more_makes_btn"+f),g=m.find(l+p+"_more"+f),h=m.find(l+p+"_less"+f);o.append(a.clear_selections_overlay()),n("."+S).on("click",function(e){e.preventDefault(),n(l+i).popup("hide")}),n(l+x).on("click",function(e){e.preventDefault(),n(l+i).popup("hide")}),n.when(t.isReady(),s.isReady()).then(function(){c.set({filters:{makes:"",make_models:"",categories:"",category_makes:""}},!0),e.on(u,k,function(){T(n(this).parent().parent())}),r.on(u,v,function(){E(n(this))}),n(l+w).on(u,function(){c.set({filters:{makes:"",make_models:"",categories:""}},!0),window.location="/cars-for-sale/results/"}),n(l+b).on(u,function(e){c.set({filters:{makes:"",make_models:"",categories:""}},!0),window.location="/cars-for-sale/results/"}),n(l+y).on(u,function(){var e,t=n("button.selected"),r=[];window.location="/cars-for-sale/selectmodels/",n.each(t,function(e,t){r.push(t.parentElement.dataset.id)}),e=r.join("|"),c.set({filters:{makes:e,make_models:"",categories:""}},!0)}),n(l+_).on(u,function(){var e,t=[];window.location="/cars-for-sale/selectcategorymakes/",n.each(n(".carsForSaleCategory").parent().parent(".selected"),function(){t.push(n(this).find("div").data("id"))}),e=t.join("|"),c.set({filters:{makes:"",make_models:"",categories:e}},!0)});var t=function(){r.find(d).show(),g.hide(),h.show(),m.one(u,s)},s=function(){r.find(d+"[data-hideable=true]").hide(),h.hide(),g.show(),m.one(u,t)};m.one(u,t)})}}}();n(function(){s.init()})}(window,jQuery,ABT)},{"../../modules/abt-svc-c4s":3,"./index_tmpls/desk/tmpls.js":2}],2:[function(e,t,n){t.exports.clear_selections_overlay=function(e){var t='<div id="clear_selections_overlay_js" class="overlay overlay-dk max-650" style="display:none"> <button type="button" class="overlay-close"> <span class="icon"> <svg> <use xlink:href="/assets/svg/global-sprite.svg#i_close"></use> </svg> </span> </button> <div class="dead-middle center"> <section id="clear-selections-container" style="display: block"> <h1 id="clear-selections-text"></h1> <div class="center"> <button id="continue-clear-selections-container" class="btn-primary lg" type="button">Continue</button> <button id="close-clear-selections-container" class="btn-default lg" type="button">Cancel</button> </div> </section> </div></div>';return t}},{}],3:[function(e,t,n){var r=function(e,t,n,r){var s,o,a,i=n.CACHE,c=n.PERSONA,l=n.UTILS,u="/api/cars-for-sale",d=n.Eventify,f=t.isPlainObject,p=t.extend,m="change",g="ready",h=e.JSON,v=h.stringify,k="|",y=!0,_=!y,w="c4s_",b=function(e){e||S.check();var n=u+"/filter-domains/",o=9e5,a=t.Deferred(),i="GET:"+n,c=s.get(i);return c?a.resolve(c.data):t.get(n).done(function(e){s.set(i,e,o),a.resolve(e.data)}).fail(function(){a.resolve(r)}),a.promise()},C=function(e){var t=e.years,n="matchVal",r=t[0][n],s=t.slice(-1)[0][n],o=M["default"];o.filters.year_range=r+k+s},S=function(){var e=new d,t=_;return{check:function(){if(!t)throw n.UTILS.SVC_ERR_MSG},set:function(n){t=n,t&&e.trigger()},on:function(n,r){n===g&&(t?r():e.register(r))}}}(),x=function(){var e=20,t="bookmarks",n="results",s="details",o={results:[],details:[]},i=function(e,t){return v(e)===v(t)};return{init:function(){o=a.get(t)||o},push:function(r,c){if(r===n){if(i(c,o.results[0]))return;o.results.unshift(c),o.results.length>e&&o.results.pop()}else if(r===s){if(i(c,o.details[0]))return;o.details.unshift(c),o.details.length>e&&o.details.pop()}a.set(t,o,a.permanent)},get:function(e,t){return t=t||0,e===n?o.results[t]:e===s?o.details[t]:r},resultsKey:n,detailsKey:s}}(),M=function(){var e=new d,t={},n=12,r=3e5,s=function(){o.set(M.cacheKey,t,r)},a=function(){e.trigger(t)},i=function(e,t){var n=l(e),r=l(t);return v(n)===v(r)},l=function(e){var t=[];for(var n in e){var r=e[n];t.push(n),f(r)&&(t=t.concat(l(r)))}return t.sort()};return{get:function(){return S.check(),t},set:function(e,n){if(S.check(),f(e)){var r=p(y,{},t,e),o=this.isValidStruct(r);return o&&(t=r,s(),n&&x.push(x.resultsKey,t),a()),o}return _},reset:function(){return S.check(),t=p(y,{},this["default"],{zipcode:c.get().zipcode||""}),s(),a(),this},restore:function(e){S.check();var n=x.get(x.resultsKey,e);return n&&(t=n,s(),a()),this},on:function(t,n){t===m&&e.register(n)},isValidStruct:function(e){return i(this["default"],e)},cacheKey:"criteria",defaultItemsPerPage:n,"default":{zipcode:"",max_mileage:0,max_price:0,radius_miles:100,page:{current:1,items_per_page:n},sort:{by:"best_match",dir:"desc"},filters:{price_range:"0|300",mileage_range:"0|300",year_range:"",makes:"",make_models:"",categories:"",category_makes:"",fuel_types:"",options:""}},packTemplate:{zipcode:"z",max_mileage:"maxm",max_price:"maxp",radius_miles:"rm",page:{"@pname":"p",current:"c",items_per_page:"ipp"},sort:{"@pname":"s",by:"b",dir:"d"},filters:{"@pname":"f",price_range:"pr",mileage_range:"mr",year_range:"yr",makes:"ma",make_models:"mm",categories:"ca",category_makes:"cm",fuel_types:"ft",options:"o"}}}}(),E=function(){var e=new d,t={};return{get:function(){return S.check(),t},set:function(n){S.check(),f(n)&&(t=n,e.trigger(t))},on:function(t,n){t===m&&e.register(n)}}}();return{isReady:function(){var e=t.Deferred();return t.when(i.init(),c.isReady()).then(function(){s=i.storage(w+"res"),o=i.storage(w+"req"),a=i.storage(w+"bkmrks")}).then(function(){return b(y)}).then(function(t){C(t),x.init(),S.set(y);var n=o.get(M.cacheKey);M.isValidStruct(n)?M.set(n):M.set(M["default"]),e.resolve(r)}),e.promise()},criteria:M,bookmarker:{get:x.get},serviceState:{on:S.on},inventory:{on:E.on,get:E.get},query:function(){S.check();var e=u+"/search/",n=3e5,o=t.Deferred(),a=M.get(),i=v(a),c="POST:"+e+i,l=s.get(c);return l?(o.resolve(l),E.set(l)):t.post(e,{"":i}).done(function(e){s.set(c,e.data,n),o.resolve(e.data),E.set(e.data)}).fail(function(){o.resolve(r)}),o.promise()},getFilterDomains:function(){return b()},getMakesWithInventoryCount:function(){S.check();var e=u+"/makes/",n=9e5,o=t.Deferred(),a="GET:"+e,i=s.get(a);return i?o.resolve(i.data):t.get(e).done(function(e){s.set(a,e,n),o.resolve(e.data)}).fail(function(){o.resolve(r)}),o.promise()},getMakeByMakeId:function(e){S.check();var n=u+"/make/"+e,o=18e5,a=t.Deferred(),i="GET:"+n,c=s.get(i);return c?a.resolve(c.data):t.get(n).done(function(e){s.set(i,e,o),a.resolve(e.data)}).fail(function(){a.resolve(r)}),a.promise()},getCategoryByCategoryId:function(e){S.check();var n=u+"/category/"+e,o=18e5,a=t.Deferred(),i="GET:"+n,c=s.get(i);return c?a.resolve(c.data):t.get(n).done(function(e){s.set(i,e,o),a.resolve(e.data)}).fail(function(){a.resolve(r)}),a.promise()},getModelsByMakeId:function(e){S.check();var n=u+"/make/"+e+"/models/",o=18e5,a=t.Deferred(),i="GET:"+n,c=s.get(i);return c?a.resolve(c.data):t.get(n).done(function(e){s.set(i,e,o),a.resolve(e.data)}).fail(function(){a.resolve(r)}),a.promise()},getMakesByCategoryId:function(e){S.check();var n=u+"/category/"+e+"/makes/",o=18e5,a=t.Deferred(),i="GET:"+n,c=s.get(i);return c?a.resolve(c.data):t.get(n).done(function(e){s.set(i,e,o),a.resolve(e.data)}).fail(function(){a.resolve(r)}),a.promise()},ping:function(e){S.check();var n=p(y,{trim_id:r,make_id:r,make:"",model:"",zipcode:""},e),o=u+"/availability-ping/zipcode/"+e.zipcode+"/",a=9e5,i=t.Deferred(),c=v(n),d="POST:"+o+c,f=s.get(d);return l.isZip(n.zipcode)||i.resolve(r),f?i.resolve(f.data):t.post(o,{"":c}).done(function(e){s.set(d,e,a),i.resolve(e.data)}).fail(function(){i.resolve(r)}),i.promise()}}}(window,jQuery,ABT,[]._);t.exports=r},{}]},{},[1]);