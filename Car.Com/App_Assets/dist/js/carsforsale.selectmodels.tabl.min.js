/*! Javascript v0.0.1 CAR.com (c)2014 - Team:http://www.car.com/humans.txt */!function e(t,n,r){function a(o,s){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return a(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,n){"use strict";!function(t,n,r){var a=function(){var t,a=e("../../modules/abt-svc-c4s"),i=r.PERSONA,o=a.criteria,s=(r.ADS,"#"),c="click",l="_js",u="selected",d=u,f="undefined",m="models",g="allmodels",p=".carsForSaleModels",v="btnChooseModels",h="btnShowResults",k="selectModelTitle",y=[],_=function(e,t){var r,a=o.get().filters,i=e.parent().data("makeid"),c=e.parent().data("value"),l=[];r=0==a.makes.length?[]:a.makes.split("|");var u;u=0==a.make_models.length?[]:a.make_models.split("|");var m=!1;if(typeof t===f&&(t=!e.hasClass(d)),e.attr("id")==g){n(p).removeClass(d),n(s+g).addClass(d),r.push(i);for(var v=0;v<u.length;v++)l=u[v].split("~"),l[0]==i&&(u.splice(v,1),v--);o.set({filters:{makes:r.join("|"),make_models:u.join("|")}})}else t?(e.addClass(d),n(s+g).removeClass(d),-1==n.inArray(c,u)&&u.push(c),n.each(r,function(e,t){return i==t?(r.splice(e,1),!1):void 0}),o.set({filters:{makes:r.join("|"),make_models:u.join("|")}})):(e.removeClass(d),n.each(u,function(e,t){return c==t?(u.splice(e,1),!1):void 0}),o.set({filters:{make_models:u.join("|")}}),m=!1,n.each(u,function(e,t){return l=t.split("~"),l[0]==i?(m=!0,!1):void 0}),m||0==i||(r.push(i),o.set({filters:{makes:r.join("|")}})))},w=function(){var e=!1;n.each(y,function(t,n){0==n.complete&&(e=!0)}),0==e&&(n(s+v).hide(),n(s+h).show())},b=function(e){n(s+m+l).html(""),n(s+m+l).append('<li><div data-id="all" data-value="0" data-makeid="'+e+'"><button type="button" id="allmodels" class="btn-mm carsForSaleModels selected">All Models</button></div></li>'),n.when(a.getMakeByMakeId(e)).then(function(e){var t=e.make;n(s+k).html("Choose "+t+" Models")}),n.when(a.getModelsByMakeId(e)).then(function(t){n.each(t.models,function(t,r){n(s+m+l).append('<li><div data-id="'+t+'" data-value="'+e+"~"+r.matchVal+'" data-makeid="'+e+'"><button type="button" id="'+r.descr+'_st" class="btn-mm carsForSaleModels">'+r.descr+"</button></div></li>"),t++})}),n.each(y,function(t,n){return n.makeId==e?(n.complete=1,!1):void 0}),w()},M=function(){var e=!1;n.each(y,function(t,n){return 0==n.complete?(e=!0,b(n.makeId,n.make),!1):void 0}),0==e&&(window.location="/cars-for-sale/results/")},S=function(){var e,t,r=o.get().filters;e=0==r.makes.length?[]:r.makes.split("|"),t=0==r.make_models.length?[]:r.make_models.split("|");var a=[],i=[];n.each(t,function(e,t){a=t.split("~"),-1==n.inArray(a[0],i)&&""!=a[0]&&i.push(a[0])}),n.each(i,function(t,r){-1==n.inArray(r,e)&&""!=r&&e.push(r)}),o.set({filters:{makes:e.join("|"),make_models:""}})},C=function(e){var t=n.Deferred();return n.each(e,function(r,i){n.when(a.getMakeByMakeId(i)).then(function(n){var r=n.make;y.push({make:r,makeId:i,complete:0}),y.length==e.length&&t.resolve()})}),t.promise()};return{init:function(){var e=n(s+m+l);n.when(a.isReady(),i.isReady()).done(function(){S(),t=0==o.get().filters.makes.length?[]:o.get().filters.makes.split("|"),0==o.get().filters.makes.length&&0==o.get().filters.make_models.length?window.location="/cars-for-sale/":n.when(C(t)).then(function(){n(s+"selectedMakes").html("You've selected "+y.map(function(e){return e.make}).join(", ")),M()}),e.on(c,p,function(){_(n(this))}),n(s+v).on(c,function(){M()}),n(s+h).on(c,function(){window.location="/cars-for-sale/results/"})})}}}();n(function(){a.init()})}(window,jQuery,ABT)},{"../../modules/abt-svc-c4s":2}],2:[function(e,t,n){var r=function(e,t,n,r){var a,i,o,s=n.CACHE,c=n.PERSONA,l=n.UTILS,u="/api/cars-for-sale",d=n.Eventify,f=t.isPlainObject,m=t.extend,g="change",p="ready",v=e.JSON,h=v.stringify,k="|",y=!0,_=!y,w="c4s_",b=function(e){e||S.check();var n=u+"/filter-domains/",i=9e5,o=t.Deferred(),s="GET:"+n,c=a.get(s);return c?o.resolve(c.data):t.get(n).done(function(e){a.set(s,e,i),o.resolve(e.data)}).fail(function(){o.resolve(r)}),o.promise()},M=function(e){var t=e.years,n="matchVal",r=t[0][n],a=t.slice(-1)[0][n],i=I["default"];i.filters.year_range=r+k+a},S=function(){var e=new d,t=_;return{check:function(){if(!t)throw n.UTILS.SVC_ERR_MSG},set:function(n){t=n,t&&e.trigger()},on:function(n,r){n===p&&(t?r():e.register(r))}}}(),C=function(){var e=20,t="bookmarks",n="results",a="details",i={results:[],details:[]},s=function(e,t){return h(e)===h(t)};return{init:function(){i=o.get(t)||i},push:function(r,c){if(r===n){if(s(c,i.results[0]))return;i.results.unshift(c),i.results.length>e&&i.results.pop()}else if(r===a){if(s(c,i.details[0]))return;i.details.unshift(c),i.details.length>e&&i.details.pop()}o.set(t,i,o.permanent)},get:function(e,t){return t=t||0,e===n?i.results[t]:e===a?i.details[t]:r},resultsKey:n,detailsKey:a}}(),I=function(){var e=new d,t={},n=12,r=3e5,a=function(){i.set(I.cacheKey,t,r)},o=function(){e.trigger(t)},s=function(e,t){var n=l(e),r=l(t);return h(n)===h(r)},l=function(e){var t=[];for(var n in e){var r=e[n];t.push(n),f(r)&&(t=t.concat(l(r)))}return t.sort()};return{get:function(){return S.check(),t},set:function(e,n){if(S.check(),f(e)){var r=m(y,{},t,e),i=this.isValidStruct(r);return i&&(t=r,a(),n&&C.push(C.resultsKey,t),o()),i}return _},reset:function(){return S.check(),t=m(y,{},this["default"],{zipcode:c.get().zipcode||""}),a(),o(),this},restore:function(e){S.check();var n=C.get(C.resultsKey,e);return n&&(t=n,a(),o()),this},on:function(t,n){t===g&&e.register(n)},isValidStruct:function(e){return s(this["default"],e)},cacheKey:"criteria",defaultItemsPerPage:n,"default":{zipcode:"",max_mileage:0,max_price:0,radius_miles:100,page:{current:1,items_per_page:n},sort:{by:"best_match",dir:"desc"},filters:{price_range:"0|300",mileage_range:"0|300",year_range:"",makes:"",make_models:"",categories:"",category_makes:"",fuel_types:"",options:""}},packTemplate:{zipcode:"z",max_mileage:"maxm",max_price:"maxp",radius_miles:"rm",page:{"@pname":"p",current:"c",items_per_page:"ipp"},sort:{"@pname":"s",by:"b",dir:"d"},filters:{"@pname":"f",price_range:"pr",mileage_range:"mr",year_range:"yr",makes:"ma",make_models:"mm",categories:"ca",category_makes:"cm",fuel_types:"ft",options:"o"}}}}(),T=function(){var e=new d,t={};return{get:function(){return S.check(),t},set:function(n){S.check(),f(n)&&(t=n,e.trigger(t))},on:function(t,n){t===g&&e.register(n)}}}();return{isReady:function(){var e=t.Deferred();return t.when(s.init(),c.isReady()).then(function(){a=s.storage(w+"res"),i=s.storage(w+"req"),o=s.storage(w+"bkmrks")}).then(function(){return b(y)}).then(function(t){M(t),C.init(),S.set(y);var n=i.get(I.cacheKey);I.isValidStruct(n)?I.set(n):I.set(I["default"]),e.resolve(r)}),e.promise()},criteria:I,bookmarker:{get:C.get},serviceState:{on:S.on},inventory:{on:T.on,get:T.get},query:function(){S.check();var e=u+"/search/",n=3e5,i=t.Deferred(),o=I.get(),s=h(o),c="POST:"+e+s,l=a.get(c);return l?(i.resolve(l),T.set(l)):t.post(e,{"":s}).done(function(e){a.set(c,e.data,n),i.resolve(e.data),T.set(e.data)}).fail(function(){i.resolve(r)}),i.promise()},getFilterDomains:function(){return b()},getMakesWithInventoryCount:function(){S.check();var e=u+"/makes/",n=9e5,i=t.Deferred(),o="GET:"+e,s=a.get(o);return s?i.resolve(s.data):t.get(e).done(function(e){a.set(o,e,n),i.resolve(e.data)}).fail(function(){i.resolve(r)}),i.promise()},getMakeByMakeId:function(e){S.check();var n=u+"/make/"+e,i=18e5,o=t.Deferred(),s="GET:"+n,c=a.get(s);return c?o.resolve(c.data):t.get(n).done(function(e){a.set(s,e,i),o.resolve(e.data)}).fail(function(){o.resolve(r)}),o.promise()},getCategoryByCategoryId:function(e){S.check();var n=u+"/category/"+e,i=18e5,o=t.Deferred(),s="GET:"+n,c=a.get(s);return c?o.resolve(c.data):t.get(n).done(function(e){a.set(s,e,i),o.resolve(e.data)}).fail(function(){o.resolve(r)}),o.promise()},getModelsByMakeId:function(e){S.check();var n=u+"/make/"+e+"/models/",i=18e5,o=t.Deferred(),s="GET:"+n,c=a.get(s);return c?o.resolve(c.data):t.get(n).done(function(e){a.set(s,e,i),o.resolve(e.data)}).fail(function(){o.resolve(r)}),o.promise()},getMakesByCategoryId:function(e){S.check();var n=u+"/category/"+e+"/makes/",i=18e5,o=t.Deferred(),s="GET:"+n,c=a.get(s);return c?o.resolve(c.data):t.get(n).done(function(e){a.set(s,e,i),o.resolve(e.data)}).fail(function(){o.resolve(r)}),o.promise()},ping:function(e){S.check();var n=m(y,{trim_id:r,make_id:r,make:"",model:"",zipcode:""},e),i=u+"/availability-ping/zipcode/"+e.zipcode+"/",o=9e5,s=t.Deferred(),c=h(n),d="POST:"+i+c,f=a.get(d);return l.isZip(n.zipcode)||s.resolve(r),f?s.resolve(f.data):t.post(i,{"":c}).done(function(e){a.set(d,e,o),s.resolve(e.data)}).fail(function(){s.resolve(r)}),s.promise()}}}(window,jQuery,ABT,[]._);t.exports=r},{}]},{},[1]);